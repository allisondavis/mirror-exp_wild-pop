---
title: "FINAL_mirror-exp_wild-pop"
author: "Allison Davis"
date: "November 19, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data collection

  * raw data: occurance number and preference score for each individual fish (left, right, NA)
  * pref data: preference scores for tank A, B, combo of A and B, and average of A and B
      - combo score determined as left/(left+right) for total left and right occurances
      - average score determined by averaging tank A pref score and tank B pref score
  * separated all data by species
  * original analyses w/20 individuals showed a significant difference between using the TOT.PROP vs AVG.PROP for latipinna only; for all tests, will repeat with AVG.PROP to see if this changes the results
    + <font color ="darkorchid4"> Tests includind AVG.PROP in place of TOT.PROP don't really change the values of the statistical tests. Will coninue with TOT.PROP.</font>

```{r echo=FALSE}
library(curl)

rawRE <- curl("https://raw.githubusercontent.com/allisondavis/mirror-exp_wild-pop/master/adavis_mirror-exp_wild-pop_rescored-raw.csv")

rawRE <- read.csv(rawRE, header = TRUE, sep = ",", stringsAsFactors = TRUE)

prefRE <- curl("https://raw.githubusercontent.com/allisondavis/mirror-exp_wild-pop/master/adavis_mirror-exp_wild-pop_rescored-props_common.csv")

prefRE <- read.csv(prefRE, header = TRUE, sep = ",", stringsAsFactors = TRUE)


#I will separate out the sexual vs asexual 

p_form.rawRE <- rawRE[rawRE$X.U.FEFF.SPP =="P.form",]

p_lat.rawRE <- rawRE[rawRE$X.U.FEFF.SPP == "P.lat",]

p_formRE <- prefRE[prefRE$X.U.FEFF.SPP== "Amazon",]


p_latRE <- prefRE[prefRE$X.U.FEFF.SPP== "Sailfin",]

```

### Analyses {.tabset .tabset-fade .tabset-pills}

#### Outlier tests

Histogram shows what appear to be outliers in both species. Will now perform a Tukey's outlier test to see if they are in fact outlier, and if removing these outliers changes the variance between species.

```{r echo=FALSE}

library(DescTools)

Outlier(p_latRE$TOT.PROP, method=c("boxplot"), value = FALSE)

#repeat for avg.prop --> STILL NO OUTLIERS

Outlier(p_latRE$AVG.PROP, method=c("boxplot"), value = FALSE)


```

* Sailfin: no outliers

```{r echo=FALSE}

Outlier(p_formRE$TOT.PROP, method =c("boxplot"), value = FALSE)
```

* Amazons: outliers at row 2, 3, 11, 19

```{r}

(PF_outliers <- p_formRE[c(2,3,11,19),])

```


<font color="darkorchid4">Looks like there are four outlier in the formosa data, but no outliers in the latipinna data.</font>

#### T-tests
I will create a new dataframe without these rows, and test for eye preference and compare variation again.

```{r echo=FALSE}
PFORM_RE <- p_formRE[-c(2,3,11,19),]
```
* t-test for eye preference 
    - Amazons:

```{r echo=FALSE}
t.test(PFORM_RE$TOT.PROP, mu=0.5, alternative = "two.sided")

```

  - Sailfins
  
```{r echo=FALSE}
t.test(p_latRE$TOT.PROP, mu=0.5, alternative = "two.sided")


  #repeat for avg.prop

t.test(p_latRE$AVG.PROP, mu=0.5, alternative = "two.sided")

```

<font color="darkorchid4"> Amazons show left-eye bias, but sailfins show no eye bias.</font>

* comparing species

    - means

```{r echo=FALSE}

t.test(p_latRE$TOT.PROP, PFORM_RE$TOT.PROP)

  #repeat w/avg.prop
t.test(p_latRE$AVG.PROP, PFORM_RE$TOT.PROP)

```

<font color="darkorchid4"> The species don't significantly differ in average eye use.</font>


#### Wilcox tests
Since we're dealing with proportions, I will use Wilcox signed rank and rank sum tests to re-analyze the data

* Tank differences
```{r}
library(curl)

rawTANKS <- curl("https://raw.githubusercontent.com/allisondavis/mirror-exp_wild-pop/master/adavis_mirrorexp-tanks.csv")

rawTANKS <- read.csv(rawTANKS, header = TRUE, sep = ",", stringsAsFactors = TRUE)

wilcox.test(PROP~TANK, data = rawTANKS, paired=TRUE)

FrawTANKS <- rawTANKS[rawTANKS$X.U.FEFF.SPP == "P.form",]
LrawTANKS <- rawTANKS[rawTANKS$X.U.FEFF.SPP == "P.lat", ]

wilcox.test(PROP~TANK, data = FrawTANKS, paired=TRUE)
wilcox.test(PROP~TANK, data = LrawTANKS, paired=TRUE)

```

<font color="darkorchid4"> No differences between the tanks, so I can analyze with total proportion.</font>


* Eye preference
  - Amazons:

```{r echo=FALSE}

wilcox.test(PFORM_RE$TOT.PROP, mu=0.5)

```

  - Sailfins
  
```{r echo=FALSE}

wilcox.test(p_latRE$TOT.PROP, mu=0.5)

  #repeat for avg.prop

wilcox.test(p_latRE$AVG.PROP, mu=0.5)

```

<font color="darkorchid4"> Amazons still have left-eye bias and sailfins still have no eye bias.</font>

* comparing species

```{r}

raw2 <- rbind(p_latRE, PFORM_RE)

wilcox.test(TOT.PROP~X.U.FEFF.SPP, data = raw2, paired=FALSE)

```

<font color="darkorchid4"> Species still don't significantly differ in average eye use.</font>



#### Variance

variances: two-sided (either spp variance greater or less)

```{r echo=FALSE}
var.test(p_latRE$TOT.PROP, PFORM_RE$TOT.PROP, alternative = "two.sided")

    #repeat w/avg.prop

var.test(p_latRE$AVG.PROP, PFORM_RE$TOT.PROP, alternative = "two.sided")

```

- variances: greater (p.lat variance > p.form)

```{r echo=FALSE}
var.test(p_latRE$TOT.PROP, PFORM_RE$TOT.PROP, alternative = "greater")

    #repeat w/avg.prop

var.test(p_latRE$AVG.PROP, PFORM_RE$TOT.PROP, alternative = "greater")

```

- variances: lesser(p.lat variance < p.form)

```{r echo=FALSE}
var.test(p_latRE$TOT.PROP, PFORM_RE$TOT.PROP, alternative = "less")

    #repeat w/avg.prop

var.test(p_latRE$AVG.PROP, PFORM_RE$TOT.PROP, alternative = "less")


```


#### Transformations

Since the preference is a proportion, parametric tests may be the incorrect form of analyses. While there is a non-parametric alternative to the t-test (Wilcox tests), I cannot seem to find an alterantive to the F-test. Upon Mike's suggestion, I'll do an arcsine transformation on the total proportion data. I will then re-run the t-tests and F-tests with this new data.

   * transform the data

```{r}

PL_trans <- transform(p_latRE, arcTOT = asin(p_latRE$TOT.PROP))

PF_trans <- transform(PFORM_RE, arcTOT = asin(PFORM_RE$TOT.PROP))

```

  * t-tests: eye preference

```{r}

t.test(PL_trans$TOT.PROP, mu=0.5, alternative = "two.sided")

t.test(PF_trans$TOT.PROP, mu=0.5, alternative = "two.sided")


```


  * t-tests: comparing species

```{r}

t.test(PL_trans$TOT.PROP, PF_trans$TOT.PROP)


```

  * variance:

```{r}

var.test(PL_trans$TOT.PROP, PF_trans$TOT.PROP, alternative = "two.sided")

var.test(PL_trans$TOT.PROP, PF_trans$TOT.PROP, alternative = "greater")

var.test(PL_trans$TOT.PROP, PF_trans$TOT.PROP, alternative = "less")


```


#### Boxplots

<font color="chocolate3">Will create boxplots using both the original, and outlier-removed data</font>

  * Will combine the total preference scores of both original and outlier-removed data into one dataset in order to use ggplot more easily.
  
```{r echo=FALSE}
library(ggplot2)
library(ggsignif)
library(gridExtra)
library(ggthemes)

OG_pref_RE <- rbind(p_latRE, p_formRE)

OR_pref_RE <- rbind(p_latRE, PFORM_RE)

orig <- ggplot(OG_pref_RE, aes(x=X.U.FEFF.SPP, y=TOT.PROP)) + geom_boxplot(outlier.colour = "red", outlier.shape = 8, outlier.size = 2) + xlab("Species") + ylab("Proportion of left-eye bias") + ggtitle("Original Data") + theme_classic()

rem_out <- ggplot(OR_pref_RE, aes(x=X.U.FEFF.SPP, y=TOT.PROP)) + geom_boxplot() + xlab("Species") + ylab("Proportion of left-eye bias") + ggtitle("Outlier-Removed Data") + theme_classic()

rem_out

grid.arrange(orig, rem_out, ncol=2)


```


#### Repeatability

<font color="deepskyblue">Consistency in eye use across trials </font>

Here I will examine if individuals were consistent with their eye preference across the two trials.
  * Since formosa were the only ones w/lateralized vision, this is more pertinent to them
    + if they are lateralized, as clones, they should also be consistent in their lateralization across trials. If they are no consistent, this might mean that the significance we see with their lateralized vision, might just be a statistically chance.
  * would be interesting to see if individuals are still consistent among trials, but overall no spp lateralization for latipinna

I will be using `cor.test(x,y,method="pearson", "kendall", "spearman")`
  * can also add `use="complete.obs"` if I have missing values 
  
  
```{r echo=FALSE}
library(ggpubr)

cor.test(p_latRE$A.PROP, p_latRE$B.PROP, method ="pearson")

cor.test(PFORM_RE$A.PROP, PFORM_RE$B.PROP, method = "pearson")

```

<font color="darkorchid4"> Looks like neither correlation is significant. I will visualize using a scatter plot below.</font>

```{r echo=FALSE}
lat_cor <- ggscatter(p_latRE, x = "A.PROP", y = "B.PROP", add = "reg.line", conf.int = TRUE, cor.coef = TRUE, cor.method = "pearson", xlab = "Eye pref in A tank", ylab = "Eye pref in B tank", title = "Sailfin")


form_cor <- ggscatter(PFORM_RE, x = "A.PROP", y = "B.PROP", add = "reg.line", conf.int = TRUE, cor.coef = TRUE, cor.method = "pearson", xlab = "Eye pref in A tank", ylab = "Eye pref in B tank", title = "Amazon")

grid.arrange(lat_cor, form_cor, ncol=2)

```



<font color="blue"> Correlation implication:</font> With both correlations as insignificant, this means that there was no consistent eye use across trials. 
  * Some form individuals who expressed left eye bias in A did express left eye bias in B, but the degree of bias was not that strong. ***Is there a way to transform data in which I look at whether or not they were left-eye period vs right-eye (like it doesn't matter their actual value, just if it's above 0.5 it's left)? Will this tell me anything differently?***
  
  
  
  
  
  
  
  
  
  
  
  
  
